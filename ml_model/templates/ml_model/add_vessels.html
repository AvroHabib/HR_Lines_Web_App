
  {%extends 'ml_model/base.html'%}
  {%block title%}Add Vessels{%endblock%}
  {%block content%}
  <h1 class="vessel-header">Enter Vessel Data</h1>

  <form id="vesselForm" class="vessel-form">
    <div id="vesselContainer">
      <!-- Initial vessel input group -->
      <div class="vessel-group-container">
        <label>
          Name: <input type="text" class="vessel-name" placeholder="Enter vessel name" required>
        </label>
        <label>
          Service: <input type="text" class="vessel-service" placeholder="Enter service" required>
        </label>
        <label>
          Operator: <input type="text" class="vessel-operator" placeholder="Enter operator" required>
        </label>
        <button type="button" class="vessel-remove-btn">Remove</button>
      </div>
    </div>
    <button type="button" id="addVesselButton" class="vessel-btn vessel-add-btn">Add Vessel</button>
    <button type="button" id="sendButton" class="vessel-btn">Send Data</button>
  </form>

  <div id="show-vessel" class="vessel-output-container"></div>

  <!-- JavaScript -->
  <script>
    // const vesselContainer = document.getElementById('vesselContainer');
    // const addVesselButton = document.getElementById('addVesselButton');
    // const sendButton = document.getElementById('sendButton');
    // // Function to add a new vessel input group
    // function addVesselInput() {
    //   const vesselGroup = document.createElement('div');
    //   vesselGroup.className = 'vessel-group-container';
    //   vesselGroup.innerHTML = `
    //     <label>
    //       Name: <input type="text" class="vessel-name" placeholder="Enter vessel name" required>
    //     </label>
    //     <label>
    //       Service: <input type="text" class="vessel-service" placeholder="Enter service" required>
    //     </label>
    //     <label>
    //       Operator: <input type="text" class="vessel-operator" placeholder="Enter operator" required>
    //     </label>
    //     <button type="button" class="vessel-remove-btn">Remove</button>
    //   `;
    //   vesselContainer.appendChild(vesselGroup);

    //   // Add remove functionality
    //   vesselGroup.querySelector('.vessel-remove-btn').addEventListener('click', () => {
    //     vesselGroup.remove();
    //   });
    // }

    // // Add remove functionality to the initial group
    // document.querySelector('.vessel-remove-btn').addEventListener('click', function () {
    //   this.closest('.vessel-group-container').remove();
    // });

    // // Event listener for "Add Vessel" button
    // addVesselButton.addEventListener('click', addVesselInput);

    // // Event listener for "Send Data" button
    // sendButton.addEventListener('click', async () => {
    //   const vessels = [];
    //   const vesselGroups = document.querySelectorAll('.vessel-group-container');

    //   // Collect data from input fields
    //   vesselGroups.forEach(group => {
    //     const name = group.querySelector('.vessel-name').value;
    //     const service = group.querySelector('.vessel-service').value;
    //     const operator = group.querySelector('.vessel-operator').value;

    //     if (name && service && operator) {
    //       vessels.push({ name, service, operator });
    //     }
    //   });

    //   const data = { vessels };
    //   console.log(data);

    const vesselContainer = document.getElementById('vesselContainer');
  const addVesselButton = document.getElementById('addVesselButton');
  const sendButton = document.getElementById('sendButton');

  // Function to save data to localStorage
  function saveVesselsToLocalStorage() {
    const vessels = [];
    const vesselGroups = document.querySelectorAll('.vessel-group-container');

    vesselGroups.forEach(group => {
      const name = group.querySelector('.vessel-name').value;
      const service = group.querySelector('.vessel-service').value;
      const operator = group.querySelector('.vessel-operator').value;

      if (name && service && operator) {
        vessels.push({ name, service, operator });
      }
    });

    localStorage.setItem('vessels', JSON.stringify(vessels));
  }

  // Function to load data from localStorage
  function loadVesselsFromLocalStorage() {
    const savedVessels = JSON.parse(localStorage.getItem('vessels')) || [];

    savedVessels.forEach(vessel => {
      console.log(vessel.name, vessel.service, vessel.operator);
      const vesselGroup = document.createElement('div');
      vesselGroup.className = 'vessel-group-container';
      vesselGroup.innerHTML = `
        <label>
          Name: <input type="text" class="vessel-name" placeholder="Enter vessel name" value='${vessel.name}' required>
        </label>
        <label>
          Service: <input type="text" class="vessel-service" placeholder="Enter service" value='${vessel.service}' required>
        </label>
        <label>
          Operator: <input type="text" class="vessel-operator" placeholder="Enter operator" value='${vessel.operator}' required>
        </label>
        <button type="button" class="vessel-remove-btn">Remove</button>
      `;
      vesselContainer.appendChild(vesselGroup);

      // Add remove functionality
      vesselGroup.querySelector('.vessel-remove-btn').addEventListener('click', () => {
        vesselGroup.remove();
        saveVesselsToLocalStorage(); // Update localStorage when a vessel is removed
      });
    });
  }

  // Function to add a new vessel input group
  function addVesselInput() {
    const vesselGroup = document.createElement('div');
    vesselGroup.className = 'vessel-group-container';
    vesselGroup.innerHTML = `
      <label>
        Name: <input type="text" class="vessel-name" placeholder="Enter vessel name" required>
      </label>
      <label>
        Service: <input type="text" class="vessel-service" placeholder="Enter service" required>
      </label>
      <label>
        Operator: <input type="text" class="vessel-operator" placeholder="Enter operator" required>
      </label>
      <button type="button" class="vessel-remove-btn">Remove</button>
    `;
    vesselContainer.appendChild(vesselGroup);

    // Add remove functionality
    vesselGroup.querySelector('.vessel-remove-btn').addEventListener('click', () => {
      vesselGroup.remove();
      saveVesselsToLocalStorage(); // Update localStorage when a vessel is removed
    });

    saveVesselsToLocalStorage(); // Save to localStorage after adding a new vessel
  }

  // Event listener for "Add Vessel" button
  addVesselButton.addEventListener('click', addVesselInput);

  // Event listener for input changes to save data automatically
  vesselContainer.addEventListener('input', saveVesselsToLocalStorage);

  // Load saved data from localStorage on page load
  window.addEventListener('load', loadVesselsFromLocalStorage);

  // Event listener for "Send Data" button
  sendButton.addEventListener('click', async () => {
    const vessels = [];
    const vesselGroups = document.querySelectorAll('.vessel-group-container');

    vesselGroups.forEach(group => {
      const name = group.querySelector('.vessel-name').value;
      const service = group.querySelector('.vessel-service').value;
      const operator = group.querySelector('.vessel-operator').value;

      if (name && service && operator) {
        vessels.push({ name, service, operator });
      }
    });

    const data = { vessels };
    console.log('Collected Data:', data);

      try {
        // Send JSON to backend
        const response = await fetch('http://localhost:8000/api/add-vessels/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        if (response.ok) {
          const result = await response.json();
          alert(`Response from backend: ${JSON.stringify(result)}`);
        } else {
          alert('Failed to send vessel data to the backend.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while sending data.');
      }
    });
  </script>

  {%endblock%}

