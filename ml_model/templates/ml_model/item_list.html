<!-- templates/item_list.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Editable Item List</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h2>Item List</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Name</th>
                <th>Quantity</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
                <tr data-id="{{ item.id }}">
                    <td contenteditable="true" class="name">{{ item.name }}</td>
                    <td contenteditable="true" class="quantity">{{ item.quantity }}</td>
                    <td>
                        <button class="update-btn">Apply Changes</button>
                        <button class="delete-btn">Delete</button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            $('.update-btn').click(function() {
                var row = $(this).closest('tr');
                var itemId = row.data('id');
                var name = row.find('.name').text().trim();
                var quantity = row.find('.quantity').text().trim();

                data = {
                    'name': name,
                    'quantity': quantity,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                };

                console.log(data);

                $.ajax({
                    url: '{% url "update_item" 0 %}'.replace('0', itemId),
                    method: 'POST',
                    data: {
                        'name': name,
                        'quantity': quantity,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.success) {
                            console.log('Item updated successfully.');
                        } else {
                            alert('Error: ' + response.error);
                        }
                    }
                });
            });

            $('.delete-btn').click(function() {
                var row = $(this).closest('tr');
                var itemId = row.data('id');

                $.ajax({
                    url: '{% url "delete_item" 0 %}'.replace('0', itemId),
                    method: 'POST',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.success) {
                            row.remove();
                            alert('Item deleted successfully.');
                        } else {
                            alert('Error: ' + response.error);
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
